submission - workshops에 DJANGO_WORKSHOPS 폴더 만들기

`mkdir DJANGO_WORKSHOPS`

`cd DJANGO_WORKSHOPS`

`py -m venv venv`

`pip install django django_extensions ipython`

python -m pip install --upgrade pip

`django-admin startproject django_workshops .`

`django-admin startapp accounts`

`django-admin startapp celebs`

Ctrl+p - settings.py 

```python
Installed_apps에
'django_extensions',

'accounts',
'celebs',
추가
```

```python
language_code를 ko-kr
time_zone을 Asia/Seoul로
```

26번 workshop

accounts 앱에 들어가서

`cd accounts/`

`touch urls.py`

`mkdir -p templates/accounts`

`cd templates/accounts/`

`touch base.html login.html signup.html`

accounts - models.py (주석)

```python
class User:
    username
    password
    email
    
    first_name
    last_name
    phone
    address
    birthday
    
    last_login
    is_superuser
    is_staff
    is_active
    date_joined
```

django_workshops - urls

```python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('accounts/', include('accounts.urls')),  # 포워딩
]
```

accounts - url.py

```python
from django.urls import path
from . import views

app_name = 'accounts'

urlpatterns = [
    path('signup/', views.signup, name='signup'),
    path('login/', views.login, name='login'),
    path('logout/', views.logout, name='logout'),
]
```

accounts - views.py

```python
from django.shortcuts import render, redirect
from django.views.decorators.http import require_http_methods
from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
from django.contrib.auth import login as auth_login, logout as auth_logout

@require_http_methods(['GET', 'POST'])
def signup(request):
    if request.user.is_authenticated:  # login 함?
        return redirect('/')
    
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()  # 회원 DB 에 저장 완료
            auth_login(request, user)  # 인증 시작
            return redirect('/')
    else:
        form = UserCreationForm()
        
    return render(request, 'accounts/signup.html', {
        'form': form,
    })

@require_http_methods(['GET', 'POST'])
def login(request):
    if request.user.is_authenticated:  # login 한 사용자가 또 로그인을?
        # return redirect('/')
    	return HttpResponse(content='또 로그인을?', status=400)
	
    if request.method == 'POST':
        form = AuthenticationForm(request, request.POST)
        if form.is_valid():
            user = form.get_user()
            auth_login(request, user)  # login 시작.(인증됨)
            return redirect('/')
    else:
        form = AuthenticationForm()
    return render(request, 'accounts/login.html', {
        'form': form
    })
            
            
def logout(request):
    auth_logout(request)
    return redirect('/')
```

base.html

```html
body 태그 안에
	{% block body %}
	{% endblock %}
```

signup.html

```html
{% extends 'accounts/base.html' %}

{% block body %}
<h1>Sign up</h1>
<form method="POST">
    {% csrf_token}
    {{ form.as_p}}
    <input type="submit">
</form>
{% endblock %}
```

python manage.py migrate auth

python manage.py migrate



http status code wrong login



login.html

```html
{% extends 'accounts/base.html' %}

{% block body %}
<h1>Log in</h1>
<form method="POST">
    {% csrf_token}
    {{ form.as_p}}
    <input type="submit">
</form>
{% endblock %}
```



`cd celebs/`

`mkdir -p templates/celebs`

`mkdir -p static/celebs/`

`touch urls.py forms.py`

`cd templates/celebs/`

`touch celeb_detail.html celeb_list.html celeb_form.html base.html`

`cd -`

`cd static/celebs/`

`mkdir images css js`

`cd -`

`cd ..`

celebs - models.py

```python
from django.db import models
from faker import Faker

class Celeb(models.Model):
    first_name = models.CharField(max_length=200)
    last_name = models.CharField(max_length=200)

f = Faker()
for _ in range(1000):
    Celeb.objects.create(first_name=f.first_name(), last_name=f.last_name())
```

`python manage.py makemigrations && python manage.py migrate`



celebs - forms.py

```python
from django import forms
from .models import Celeb

class CelebForm(forms.ModelForm):
    class Meta:
        model = Celeb
        fields = '__all__'
```

`pip install faker`  # fake로 데이터를 만드는

python faker 참고

```
python manage.py shell_plus
from faker import Faker
f = Faker()
f.name()
```

`python manage.py shell_plus`

Celeb.dummy(10)

Celeb.objects.all()

from django.conf import settings

settings.AUTH_USER_MODEL



celebs에 fixtures라는 새폴더 만들기



`python manage.py dumpdata celebs`

`python manage.py dumpdata celebs > celebs/fixtures/celeb_data.json`

`python manage.py migrate celebs zero`

`python manage.py migrate`

`python manage.py loaddata celeb_data`



 celeb_data.json 

```json
[{
    "model": "myapp.musician", 
    "pk": 1, 
    "fields": {
        "first_name": "Eric", 
        "last_name": "Davis"
    }
}, {
    "model": "myapp.musician", 
    "pk": 2, 
    "fields": {
        "first_name": "Debra", 
        "last_name": "Barr"}
    }
}]
```



XML :  Extensible Markup Language

JSON :  JavaScript Object Notation

YAML :  YAML Ain't Markup Language

PHP



`pip install pyyaml`

`python manage.py dumpdata celebs --format=yaml > celebs/fixtures/celeb_data.yaml`

`python manage.py dumpdata celebs --format=xml > celebs/fixtures/celeb_data.xml`

`python manage.py dumpdata celebs --format=json > celebs/fixtures/celeb_data.json`



models.py

```python
from django.db import models
from faker import Faker

from django.core.exceptions import ValidationError

class Celeb(models.Model):
    first_name = models.CharField(max_length=200)
    last_name = models.CharField(max_length=200)

    @classmethod
    def dummy(cls, n):
        f = Faker()
        for _ in range(n):
            cls.objects.create(first_name=f.first_name(), last_name=f.last_name())

# validate_even = lambda number: raise ValidationError(f'{number} is not even', params={'value': number}) if number % 2

def validate_even(number):
    if number % 2:
        raise ValidationError(f'{number} is not even', params={'value': number})

class Person(models.Model):
    last_name = models.CharField(max_length=50)
    email = models.CharField(max_length=100, validators=[])
    age = models.IntegerField(validators=[validate_even])
```

`python manage.py makemigrations celebs`

`python manage.py migrate`



celebs - admin.py

```python
from django.contrib import admin
from .models import Person

admin.site.register(Person)
```



`python manage.py createsuperuser`



celebs 폴더에 validators.py 만들고

```python
from django.core.exceptions import ValidationError

def validate_even(number):
    if number % 2:
        raise ValidationError(f'{number} is not even', params={'value': number})

def validate_too_old(number):
    if number > 150:
        raise ValidationError(f'{number} 까지 살 수 없어요..', params={'value': number})
```

models.py에서 

```python
from django.db import models
from faker import Faker

from .validators import validate_too_old, validate_even

# from django.core.exceptions import ValidationError

class Celeb(models.Model):
    first_name = models.CharField(max_length=200)
    last_name = models.CharField(max_length=200)

    @classmethod
    def dummy(cls, n):
        f = Faker()
        for _ in range(n):
            cls.objects.create(first_name=f.first_name(), last_name=f.last_name())

# validate_even = lambda number: raise ValidationError(f'{number} is not even', params={'value': number}) if number % 2

# def validate_even(number):
#     if number % 2:
#         raise ValidationError(f'{number} is not even', params={'value': number})

class Person(models.Model):
    last_name = models.CharField(max_length=50)
    email = models.CharField(max_length=100, validators=[])
    age = models.IntegerField(validators=[validate_even, validate_too_old])
```

forms.py

```python
from django import forms
from .models import Celeb
from .validators import validate_too_old, validate_even

class CelebForm(forms.ModelForm):
    class Meta:
        model = Celeb
        fields = '__all__'

class PersonForm(forms.ModelForm):
    age = forms.Interger(validators=[validate_too_old, validate_even])
    class Meta:
        model = PersonForm
        fields = '__all__'
```



models.py

```python
from django.db import models
from faker import Faker

# Custom Validators
from .validators import validate_too_old, validate_even

# Built-in Validators
from django.core.validators import EmailValidator

# from django.core.exceptions import ValidationError

class Celeb(models.Model):
    first_name = models.CharField(max_length=200)
    last_name = models.CharField(max_length=200)

    @classmethod
    def dummy(cls, n):
        f = Faker()
        for _ in range(n):
            cls.objects.create(first_name=f.first_name(), last_name=f.last_name())

# validate_even = lambda number: raise ValidationError(f'{number} is not even', params={'value': number}) if number % 2

# def validate_even(number):
#     if number % 2:
#         raise ValidationError(f'{number} is not even', params={'value': number})

class Person(models.Model):
    last_name = models.CharField(max_length=50)
    email = models.CharField(max_length=100, validators=[EmailValidator('이메일 형식에 맞지 않습니다.')])
    age = models.IntegerField(validators=[validate_even, validate_too_old])
```



validators.py

```python
from django.core.exceptions import ValidationError

def validate_even(number):
    if number % 2:
        raise ValidationError(f'{number} is not even', params={'value': number})

def validate_too_old(number):
    if number > 150:
        raise ValidationError(f'{number} 까지 살 수 없어요..', params={'value': number})

def validate_too_young(age):
    if age < 20:
        raise ValidationError(f'미성년자는 노노')
```



validators.py

```python
from django.db import models
from faker import Faker

# Custom Validators
from .validators import validate_too_old, validate_even, validate_too_young

# Built-in Validators
from django.core.validators import EmailValidator

# from django.core.exceptions import ValidationError

class Celeb(models.Model):
    first_name = models.CharField(max_length=200)
    last_name = models.CharField(max_length=200)

    @classmethod
    def dummy(cls, n):
        f = Faker()
        for _ in range(n):
            cls.objects.create(first_name=f.first_name(), last_name=f.last_name())

# validate_even = lambda number: raise ValidationError(f'{number} is not even', params={'value': number}) if number % 2

# def validate_even(number):
#     if number % 2:
#         raise ValidationError(f'{number} is not even', params={'value': number})

class Person(models.Model):
    last_name = models.CharField(max_length=50)
    email = models.CharField(max_length=100, validators=[EmailValidator('이메일 형식에 맞지 않습니다.')])
    age = models.IntegerField(validators=[
        validate_even,
        validate_too_old, 
        validate_too_young
        ])
```



models.py

```python
from django.db import models
from faker import Faker

# Custom Validators
from .validators import validate_too_old, validate_even, validate_too_young

# Built-in Validators
from django.core.validators import EmailValidator

# from django.core.exceptions import ValidationError

class Celeb(models.Model):
    first_name = models.CharField(max_length=200)
    last_name = models.CharField(max_length=200)

    @classmethod
    def dummy(cls, n):
        f = Faker()
        for _ in range(n):
            cls.objects.create(first_name=f.first_name(), last_name=f.last_name())

# validate_even = lambda number: raise ValidationError(f'{number} is not even', params={'value': number}) if number % 2

# def validate_even(number):
#     if number % 2:
#         raise ValidationError(f'{number} is not even', params={'value': number})

class Person(models.Model):
    last_name = models.CharField(max_length=50)
    email = models.CharField(max_length=100, validators=[EmailValidator('이메일 형식에 맞지 않습니다.')])
    age = models.IntegerField(validators=[
        validate_even,
        validate_too_old, 
        validate_too_young
        ])
    # age = models.IntegerField(validators=[MinValueValidator(20, '미성년자 노노')])  # 안됨
```

celebs - templates - celebs - base.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath">
    <title>Document</title>
</head>
<body>
    
</body>
</html>
```

 https://getbootstrap.com/docs/4.3/getting-started/download/ 

다운로드

C:\Users\student\submission\workshops\DJANGO_WORKSHOPS\celebs\static\celebs에 css와 js 복붙(css에 bootstrap.min.css만 있으면 됨)

(안되면 https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css 새탭에 붙여넣고 복붙해서 css에 새파일 bootstrap.min.css에 복붙)



base.html

```html
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'celebs/css/bootstrap.min.css' %}">
    <title>Document</title>
</head>
<body>
    
</body>
</html>
```



celebs - views.py

```python
from django.shortcuts import render
from .models import Person
from .forms import PersonForm

def create_person(request):
    if request.method == 'POST':
        form = PersonForm(request.POST)
        if form.is_valid():
            person = PersonForm.save()
            return redirect('')
    return render(request, 'celebs/celeb_form.html', {
        'form': form
    })
```

노트북 가상환경 해놨는데 안잡힐때

`rm -rf venv/`

`py -m venv venv`

